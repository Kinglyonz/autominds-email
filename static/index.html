<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AutoMinds ‚Äî Synthetic Employees</title>
<style>
  :root {
    --bg: #07080a; --surface: #0f1117; --card: #151820; --border: #1e2230;
    --text: #e4e7ec; --text2: #8b92a5; --accent: #00d4ff; --accent2: #6c5ce7;
    --green: #00e88f; --orange: #ff9f43; --red: #ff5757; --purple: #a855f7;
    --radius: 12px;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
         background: var(--bg); color: var(--text); line-height: 1.6; min-height:100vh; }

  /* ‚îÄ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ */
  .nav { display:flex; align-items:center; justify-content:space-between; padding:16px 32px;
         border-bottom:1px solid var(--border); background: var(--surface); position:sticky; top:0; z-index:100; }
  .nav-brand { font-size:20px; font-weight:700; color:var(--accent); letter-spacing:-0.5px; }
  .nav-brand span { color: var(--text2); font-weight:400; font-size:14px; margin-left:8px; }
  .nav-user { display:flex; align-items:center; gap:12px; }
  .nav-user .email { color:var(--text2); font-size:13px; }
  .nav-user .avatar { width:32px; height:32px; border-radius:50%; background:var(--accent2);
    display:flex; align-items:center; justify-content:center; font-size:14px; font-weight:600; }
  .nav-links { display:flex; gap:4px; }
  .nav-links a { padding:8px 16px; color:var(--text2); text-decoration:none; border-radius:8px;
    font-size:14px; font-weight:500; transition:.2s; }
  .nav-links a:hover, .nav-links a.active { color:var(--text); background:var(--card); }

  /* ‚îÄ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ‚îÄ */
  .container { max-width:1200px; margin:0 auto; padding:32px 24px; }
  .page { display:none; } .page.active { display:block; }

  /* ‚îÄ‚îÄ‚îÄ HERO ‚îÄ‚îÄ‚îÄ */
  .hero { text-align:center; padding:48px 0 32px; }
  .hero h1 { font-size:36px; font-weight:800; letter-spacing:-1px; margin-bottom:8px; }
  .hero h1 em { font-style:normal; color:var(--accent); }
  .hero p { color:var(--text2); font-size:16px; max-width:560px; margin:0 auto; }

  /* ‚îÄ‚îÄ‚îÄ CONNECT BANNER ‚îÄ‚îÄ‚îÄ */
  .connect-banner { background: linear-gradient(135deg, #0d1b3e, #0a1628); border:1px solid var(--border);
    border-radius:var(--radius); padding:32px; text-align:center; margin:24px 0 40px; }
  .connect-banner h2 { font-size:20px; margin-bottom:8px; }
  .connect-banner p { color:var(--text2); font-size:14px; margin-bottom:20px; }
  .btn { display:inline-flex; align-items:center; gap:8px; padding:12px 28px; border-radius:10px;
    font-size:15px; font-weight:600; text-decoration:none; border:none; cursor:pointer; transition:.2s; }
  .btn-primary { background:var(--accent); color:#000; }
  .btn-primary:hover { background:#00b8e6; transform:translateY(-1px); }
  .btn-outline { background:transparent; border:1.5px solid var(--border); color:var(--text); }
  .btn-outline:hover { border-color:var(--accent); color:var(--accent); }
  .btn-sm { padding:8px 16px; font-size:13px; border-radius:8px; }
  .btn-green { background:var(--green); color:#000; }
  .btn-green:hover { background:#00cc7a; }
  .btn-disabled { opacity:.4; pointer-events:none; }

  /* ‚îÄ‚îÄ‚îÄ CARDS GRID ‚îÄ‚îÄ‚îÄ */
  .section-title { font-size:14px; font-weight:600; color:var(--text2); text-transform:uppercase;
    letter-spacing:1.5px; margin-bottom:16px; }
  .employees-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap:16px; }
  .emp-card { background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
    padding:24px; transition:.2s; position:relative; overflow:hidden; }
  .emp-card:hover { border-color: var(--accent); transform:translateY(-2px); }
  .emp-card .badge { position:absolute; top:16px; right:16px; padding:4px 10px; border-radius:20px;
    font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; }
  .badge-free { background: rgba(0,232,143,.15); color: var(--green); }
  .badge-price { background: rgba(168,85,247,.15); color: var(--purple); }
  .badge-soon { background: rgba(139,146,165,.1); color: var(--text2); }
  .emp-icon { font-size:36px; margin-bottom:12px; }
  .emp-card h3 { font-size:17px; font-weight:700; margin-bottom:4px; }
  .emp-card .role { color:var(--accent); font-size:12px; font-weight:600; text-transform:uppercase;
    letter-spacing:0.5px; margin-bottom:8px; }
  .emp-card .desc { color:var(--text2); font-size:13px; line-height:1.5; margin-bottom:16px; }
  .emp-skills { display:flex; flex-wrap:wrap; gap:6px; margin-bottom:16px; }
  .skill-tag { padding:4px 10px; background:rgba(0,212,255,.08); border:1px solid rgba(0,212,255,.15);
    border-radius:6px; font-size:11px; color:var(--accent); font-weight:500; }
  .emp-card .emp-action { width:100%; }

  /* ‚îÄ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ‚îÄ */
  .stats-row { display:grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap:12px; margin-bottom:24px; }
  .stat-card { background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
    padding:20px; }
  .stat-card .label { font-size:12px; color:var(--text2); text-transform:uppercase; letter-spacing:1px; }
  .stat-card .value { font-size:28px; font-weight:800; margin-top:4px; letter-spacing:-1px; }
  .stat-card .value.accent { color:var(--accent); }
  .stat-card .value.green { color:var(--green); }

  .briefing-box { background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
    padding:24px; margin-bottom:20px; }
  .briefing-box h3 { font-size:16px; margin-bottom:12px; display:flex; align-items:center; gap:8px; }
  .briefing-text { color:var(--text2); font-size:14px; white-space:pre-wrap; line-height:1.7; }
  .briefing-text .loading { color:var(--text2); font-style:italic; }

  .email-list { display:flex; flex-direction:column; gap:8px; }
  .email-item { background:var(--card); border:1px solid var(--border); border-radius:10px;
    padding:16px 20px; display:flex; align-items:flex-start; gap:14px; cursor:pointer; transition:.15s; }
  .email-item:hover { border-color:var(--accent); }
  .email-priority { width:4px; min-height:40px; border-radius:4px; flex-shrink:0; margin-top:2px; }
  .priority-urgent { background:var(--red); }
  .priority-high { background:var(--orange); }
  .priority-normal { background:var(--accent); }
  .priority-low { background:var(--text2); }
  .email-content { flex:1; min-width:0; }
  .email-from { font-size:14px; font-weight:600; }
  .email-subject { font-size:13px; color:var(--text2); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .email-meta { display:flex; gap:8px; align-items:center; margin-top:4px; }
  .email-cat { padding:2px 8px; border-radius:4px; font-size:10px; font-weight:600; text-transform:uppercase;
    background:rgba(0,212,255,.1); color:var(--accent); }
  .email-time { font-size:11px; color:var(--text2); }
  .email-summary { font-size:12px; color:var(--text2); margin-top:6px; line-height:1.4; }

  /* ‚îÄ‚îÄ‚îÄ AGENT STATUS ‚îÄ‚îÄ‚îÄ */
  .agent-bar { display:flex; align-items:center; gap:12px; padding:12px 20px; background:var(--card);
    border:1px solid var(--border); border-radius:10px; margin-bottom:20px; font-size:13px; }
  .agent-dot { width:8px; height:8px; border-radius:50%; }
  .dot-active { background:var(--green); box-shadow:0 0 8px var(--green); }
  .dot-inactive { background:var(--text2); }
  .agent-bar .label { color:var(--text2); }
  .agent-bar .status { font-weight:600; }

  /* ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ */
  .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.7); z-index:200; display:none;
    align-items:center; justify-content:center; padding:20px; }
  .modal-overlay.open { display:flex; }
  .modal { background:var(--surface); border:1px solid var(--border); border-radius:16px;
    max-width:550px; width:100%; max-height:80vh; overflow-y:auto; padding:32px; }
  .modal h2 { margin-bottom:16px; }
  .modal .close { float:right; background:none; border:none; color:var(--text2); font-size:24px; cursor:pointer; }

  /* ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ */
  .toast { position:fixed; bottom:24px; right:24px; padding:14px 24px; background:var(--green); color:#000;
    border-radius:10px; font-size:14px; font-weight:600; z-index:300; transform:translateY(100px);
    transition:.3s; opacity:0; }
  .toast.show { transform:translateY(0); opacity:1; }

  /* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
  @media (max-width:768px) {
    .nav { padding:12px 16px; flex-wrap:wrap; gap:8px; }
    .container { padding:16px; }
    .hero h1 { font-size:26px; }
    .employees-grid { grid-template-columns: 1fr; }
    .stats-row { grid-template-columns: 1fr 1fr; }
  }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê -->
<nav class="nav">
  <div class="nav-brand">AutoMinds <span>Synthetic Employees</span></div>
  <div class="nav-links">
    <a href="#marketplace" class="active" onclick="showPage('marketplace',this)">Marketplace</a>
    <a href="#dashboard" onclick="showPage('dashboard',this)">Dashboard</a>
    <a href="/docs" target="_blank">API</a>
  </div>
  <div class="nav-user" id="navUser">
    <span class="email" id="navEmail">Not connected</span>
    <div class="avatar" id="navAvatar">?</div>
  </div>
</nav>

<!-- ‚ïê‚ïê‚ïê MARKETPLACE PAGE ‚ïê‚ïê‚ïê -->
<div class="container page active" id="page-marketplace">
  <div class="hero">
    <h1>Hire <em>Synthetic Employees</em></h1>
    <p>AI workers that solve one problem really, really well. Enable the ones you need ‚Äî they work 24/7.</p>
  </div>

  <div class="connect-banner" id="connectBanner">
    <h2>Connect Your Gmail to Get Started</h2>
    <p>Your Email Assistant is free forever. Connect Gmail and your first synthetic employee starts working immediately.</p>
    <a href="/auth/google" class="btn btn-primary">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18A10.96 10.96 0 001 12c0 1.77.42 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
      Connect Gmail ‚Äî It's Free
    </a>
  </div>

  <div class="section-title" style="margin-top:40px;">Available Synthetic Employees</div>
  <div class="employees-grid">

    <!-- EMAIL ASSISTANT ‚Äî FREE -->
    <div class="emp-card">
      <div class="badge badge-free">Free</div>
      <div class="emp-icon">üìß</div>
      <h3>Email Assistant</h3>
      <div class="role">Inbox Manager</div>
      <div class="desc">Reads every email, prioritizes what matters, writes your first draft, and delivers a daily briefing. Never miss an important email again.</div>
      <div class="emp-skills">
        <span class="skill-tag">Gmail API</span>
        <span class="skill-tag">Claude Opus</span>
        <span class="skill-tag">Smart Priority</span>
        <span class="skill-tag">Draft Replies</span>
        <span class="skill-tag">Daily Briefing</span>
      </div>
      <a href="/auth/google" class="btn btn-green btn-sm emp-action" id="emailEnableBtn">Enable ‚Äî Free Forever</a>
    </div>

    <!-- CRM ‚Äî $10/mo -->
    <div class="emp-card">
      <div class="badge badge-price">$10/mo</div>
      <div class="emp-icon">ü§ù</div>
      <h3>Relationship Manager</h3>
      <div class="role">Lightweight CRM</div>
      <div class="desc">Tracks every contact, relationship history, and conversation context. Proactively nudges you when you haven't followed up. Drafts all outreach.</div>
      <div class="emp-skills">
        <span class="skill-tag">Google Contacts</span>
        <span class="skill-tag">Email History</span>
        <span class="skill-tag">Auto Follow-up</span>
        <span class="skill-tag">Relationship Score</span>
      </div>
      <button class="btn btn-outline btn-sm emp-action btn-disabled">Coming Soon</button>
    </div>

    <!-- BOOKKEEPER ‚Äî $15/mo -->
    <div class="emp-card">
      <div class="badge badge-price">$15/mo</div>
      <div class="emp-icon">üìä</div>
      <h3>Bookkeeper</h3>
      <div class="role">Financial Tracker</div>
      <div class="desc">Scans receipts, invoices, and bank statements. Categorizes expenses, tracks revenue, and generates financial reports in Google Sheets.</div>
      <div class="emp-skills">
        <span class="skill-tag">Google Sheets</span>
        <span class="skill-tag">Receipt Scan</span>
        <span class="skill-tag">Bank Sync</span>
        <span class="skill-tag">Reports</span>
      </div>
      <button class="btn btn-outline btn-sm emp-action btn-disabled">Coming Soon</button>
    </div>

    <!-- KNOWLEDGE BASE ‚Äî $10/mo -->
    <div class="emp-card">
      <div class="badge badge-price">$10/mo</div>
      <div class="emp-icon">üß†</div>
      <h3>Knowledge Analyst</h3>
      <div class="role">RAG Database</div>
      <div class="desc">Connect Google Drive or OneDrive. Drop files in a folder ‚Äî instantly searchable. Ask questions about your own documents, contracts, and notes.</div>
      <div class="emp-skills">
        <span class="skill-tag">Google Drive</span>
        <span class="skill-tag">OneDrive</span>
        <span class="skill-tag">Vector Search</span>
        <span class="skill-tag">RAG</span>
      </div>
      <button class="btn btn-outline btn-sm emp-action btn-disabled">Coming Soon</button>
    </div>

    <!-- SCHEDULER ‚Äî $10/mo -->
    <div class="emp-card">
      <div class="badge badge-price">$10/mo</div>
      <div class="emp-icon">üìÖ</div>
      <h3>Schedule Coordinator</h3>
      <div class="role">Calendar Manager</div>
      <div class="desc">Manages your calendar, schedules meetings with Google Meet, records calls, emails participants, and handles rescheduling automatically.</div>
      <div class="emp-skills">
        <span class="skill-tag">Google Calendar</span>
        <span class="skill-tag">Google Meet</span>
        <span class="skill-tag">Auto-Schedule</span>
        <span class="skill-tag">Reminders</span>
      </div>
      <button class="btn btn-outline btn-sm emp-action btn-disabled">Coming Soon</button>
    </div>

    <!-- CONTENT WRITER ‚Äî $15/mo -->
    <div class="emp-card">
      <div class="badge badge-price">$15/mo</div>
      <div class="emp-icon">‚úçÔ∏è</div>
      <h3>Content Writer</h3>
      <div class="role">Document Creator</div>
      <div class="desc">Writes proposals, reports, and docs on demand. Creates Google Docs and shares links. Uses your knowledge base for context and tone matching.</div>
      <div class="emp-skills">
        <span class="skill-tag">Google Docs</span>
        <span class="skill-tag">Google Drive</span>
        <span class="skill-tag">Templates</span>
        <span class="skill-tag">Tone Match</span>
      </div>
      <button class="btn btn-outline btn-sm emp-action btn-disabled">Coming Soon</button>
    </div>

  </div>

  <div style="text-align:center; margin-top:48px; padding:32px; color:var(--text2); font-size:13px;">
    <p>Every synthetic employee is built on <strong style="color:var(--accent)">Google APIs</strong> ‚Äî your data stays in your Google account.</p>
    <p style="margin-top:4px;">Powered by Claude Opus 4 + Gemini Flash for speed.</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê DASHBOARD PAGE ‚ïê‚ïê‚ïê -->
<div class="container page" id="page-dashboard">
  <div id="dashNotConnected" style="text-align:center; padding:80px 20px;">
    <div style="font-size:48px; margin-bottom:16px;">üìß</div>
    <h2>Connect Gmail to see your dashboard</h2>
    <p style="color:var(--text2); margin:12px 0 24px;">Your Email Assistant will analyze your inbox and show you what matters.</p>
    <a href="/auth/google" class="btn btn-primary">Connect Gmail ‚Äî Free</a>
  </div>

  <div id="dashConnected" style="display:none;">
    <!-- Agent Status Bar -->
    <div class="agent-bar">
      <div class="agent-dot dot-active" id="agentDot"></div>
      <span class="label">Email Assistant</span>
      <span class="status" style="color:var(--green)" id="agentStatusText">Active</span>
      <span style="flex:1"></span>
      <span class="label" id="agentLastRun"></span>
      <button class="btn btn-outline btn-sm" onclick="runAgentNow()">Run Now</button>
    </div>

    <!-- Stats -->
    <div class="stats-row">
      <div class="stat-card">
        <div class="label">Unread Emails</div>
        <div class="value accent" id="statUnread">‚Äî</div>
      </div>
      <div class="stat-card">
        <div class="label">Urgent</div>
        <div class="value" style="color:var(--red)" id="statUrgent">‚Äî</div>
      </div>
      <div class="stat-card">
        <div class="label">Drafts Pending</div>
        <div class="value" style="color:var(--orange)" id="statDrafts">‚Äî</div>
      </div>
      <div class="stat-card">
        <div class="label">Tasks</div>
        <div class="value green" id="statTasks">‚Äî</div>
      </div>
    </div>

    <!-- Briefing -->
    <div class="briefing-box">
      <h3>üìã Today's Briefing <button class="btn btn-outline btn-sm" style="margin-left:auto;" onclick="loadBriefing(true)">Refresh</button></h3>
      <div class="briefing-text" id="briefingContent"><span class="loading">Loading your briefing...</span></div>
    </div>

    <!-- Emails -->
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;">
      <div class="section-title" style="margin:0;">Priority Inbox</div>
      <button class="btn btn-outline btn-sm" onclick="loadEmails()">Refresh</button>
    </div>
    <div class="email-list" id="emailList">
      <div style="text-align:center; padding:40px; color:var(--text2);">Loading emails...</div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê -->
<div class="toast" id="toast"></div>

<script>
const API = '';
let userId = localStorage.getItem('autominds_user_id');
let userEmail = localStorage.getItem('autominds_email');
let userName = localStorage.getItem('autominds_name');

// ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ
function init() {
  if (userId) {
    document.getElementById('navEmail').textContent = userEmail || '';
    document.getElementById('navAvatar').textContent = (userName || userEmail || '?')[0].toUpperCase();
    document.getElementById('connectBanner').style.display = 'none';
    document.getElementById('emailEnableBtn').textContent = '‚úì Enabled';
    document.getElementById('emailEnableBtn').classList.add('btn-disabled');
    document.getElementById('emailEnableBtn').href = '#';
    document.getElementById('dashNotConnected').style.display = 'none';
    document.getElementById('dashConnected').style.display = 'block';
  }
  // Check hash
  if (window.location.hash === '#dashboard' && userId) {
    showPage('dashboard', document.querySelector('a[href="#dashboard"]'));
  }
}

// ‚îÄ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ‚îÄ
function showPage(name, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
  const page = document.getElementById('page-' + name);
  if (page) page.classList.add('active');
  if (el) el.classList.add('active');
  if (name === 'dashboard' && userId) {
    loadDashboard();
  }
}

// ‚îÄ‚îÄ‚îÄ Dashboard Loading ‚îÄ‚îÄ‚îÄ
let dashLoaded = false;
function loadDashboard() {
  if (!userId) return;
  if (!dashLoaded) {
    loadBriefing();
    loadEmails();
    loadAgentStatus();
    loadDrafts();
    loadTasks();
    dashLoaded = true;
  }
}

async function loadBriefing(force = false) {
  const el = document.getElementById('briefingContent');
  el.innerHTML = '<span class="loading">Generating your briefing with Claude Opus...</span>';
  try {
    const r = await fetch(`${API}/briefing?user_id=${userId}&force_new=${force}`);
    const d = await r.json();
    if (d.full_text) {
      el.textContent = d.full_text;
    } else if (d.detail) {
      el.innerHTML = '<span class="loading">' + d.detail + '</span>';
    } else {
      el.textContent = 'üéâ Inbox zero! No unread emails.';
    }
  } catch(e) {
    el.innerHTML = '<span class="loading">Could not load briefing. Connect Gmail first.</span>';
  }
}

async function loadEmails() {
  const el = document.getElementById('emailList');
  try {
    const r = await fetch(`${API}/emails?user_id=${userId}&max_results=15&analyze=true`);
    const d = await r.json();
    if (d.detail) { el.innerHTML = `<div style="text-align:center;padding:40px;color:var(--text2)">${d.detail}</div>`; return; }
    document.getElementById('statUnread').textContent = d.count || 0;
    let urgent = 0;
    el.innerHTML = '';
    if (!d.emails || d.emails.length === 0) {
      el.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text2)">üéâ Inbox zero!</div>';
      return;
    }
    d.emails.forEach(e => {
      const pri = (e.priority || 'normal').toLowerCase();
      if (pri === 'urgent') urgent++;
      const cat = e.category || '';
      const from = e.sender?.name || e.sender?.email || 'Unknown';
      const time = e.date ? new Date(e.date).toLocaleString('en-US', {month:'short',day:'numeric',hour:'numeric',minute:'2-digit'}) : '';
      el.innerHTML += `
        <div class="email-item" onclick="showEmailDetail('${e.id}')">
          <div class="email-priority priority-${pri}"></div>
          <div class="email-content">
            <div class="email-from">${esc(from)}</div>
            <div class="email-subject">${esc(e.subject || '(no subject)')}</div>
            <div class="email-meta">
              ${cat ? `<span class="email-cat">${esc(cat)}</span>` : ''}
              <span class="email-time">${time}</span>
            </div>
            ${e.summary ? `<div class="email-summary">${esc(e.summary)}</div>` : ''}
          </div>
        </div>`;
    });
    document.getElementById('statUrgent').textContent = urgent;
  } catch(e) {
    el.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text2)">Connect Gmail to see emails</div>';
  }
}

async function loadDrafts() {
  try {
    const r = await fetch(`${API}/drafts?user_id=${userId}`);
    const d = await r.json();
    document.getElementById('statDrafts').textContent = d.count || 0;
  } catch(e) { document.getElementById('statDrafts').textContent = '0'; }
}

async function loadTasks() {
  try {
    const r = await fetch(`${API}/tasks?user_id=${userId}`);
    const d = await r.json();
    document.getElementById('statTasks').textContent = d.count || 0;
  } catch(e) { document.getElementById('statTasks').textContent = '0'; }
}

async function loadAgentStatus() {
  try {
    const r = await fetch(`${API}/agent/status`);
    const d = await r.json();
    const dot = document.getElementById('agentDot');
    const txt = document.getElementById('agentStatusText');
    if (d.enabled) {
      dot.className = 'agent-dot dot-active';
      txt.textContent = 'Active';
      txt.style.color = 'var(--green)';
    } else {
      dot.className = 'agent-dot dot-inactive';
      txt.textContent = 'Disabled';
      txt.style.color = 'var(--text2)';
    }
    if (d.status?.last_run) {
      document.getElementById('agentLastRun').textContent = 'Last run: ' + new Date(d.status.last_run).toLocaleTimeString();
    }
  } catch(e) {}
}

async function runAgentNow() {
  toast('Running agent...');
  try {
    const r = await fetch(`${API}/agent/run-now?user_id=${userId}`, {method:'POST'});
    const d = await r.json();
    toast('Agent cycle complete!');
    loadEmails();
    loadBriefing();
    loadAgentStatus();
  } catch(e) { toast('Agent run failed'); }
}

function showEmailDetail(emailId) {
  // TODO: open modal with email detail + draft reply
  toast('Email detail view coming soon');
}

// ‚îÄ‚îÄ‚îÄ Utils ‚îÄ‚îÄ‚îÄ
function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ‚îÄ‚îÄ‚îÄ Boot ‚îÄ‚îÄ‚îÄ
init();
</script>
</body>
</html>
